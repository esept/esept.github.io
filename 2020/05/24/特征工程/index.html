<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />



















  
  
  
  

  
    
    
  

  
    
      
    

    
  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Righteous:300,300italic,400,400italic,700,700italic|ZCOOL XiaoWei:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.0.1" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.0.1">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.0.1">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.0.1">


  <link rel="mask-icon" href="/images/logo.svg?v=6.0.1" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="不知道会不会有人点这里，但是我还是打算写点东西 下面的链接是个人简历 然后,这里是我的简历 还有在线版,根据项目实时更新 暂时所有文章都是我的笔记,但是准备以后每周写个总结什么的 分类就是分类,归档就是归档, ​                                            ————————————————-10-10-2021————————————————- 很久之后的">
<meta property="og:type" content="website">
<meta property="og:title" content="关于我">
<meta property="og:url" content="https://esept.github.io/about/index.html">
<meta property="og:site_name" content="Indéfini-未定义的我">
<meta property="og:description" content="不知道会不会有人点这里，但是我还是打算写点东西 下面的链接是个人简历 然后,这里是我的简历 还有在线版,根据项目实时更新 暂时所有文章都是我的笔记,但是准备以后每周写个总结什么的 分类就是分类,归档就是归档, ​                                            ————————————————-10-10-2021————————————————- 很久之后的">
<meta property="og:locale">
<meta property="article:published_time" content="2020-05-08T07:52:59.000Z">
<meta property="article:modified_time" content="2021-10-15T20:53:29.278Z">
<meta property="article:author" content="HsUSH">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Gemini',
    version: '6.0.1',
    sidebar: {"position":"right","display":"always","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://esept.github.io/about/"/>





  <title>特征工程 | Indéfini-未定义的我</title>
  








<meta name="generator" content="Hexo 5.4.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-right page-post-detail">
    <div class="headband"></div>

    

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"> <div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Indéfini-未定义的我</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Demain est un autre cauchemar</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            首页</a>
        </li>
      
        
        <li class="menu-item menu-item-aboutme">
          <a href="/about" rel="section">
            AboutMe</a>
        </li>
      
        
        <li class="menu-item menu-item-to52">
          <a href="/tags/TO52" rel="section">
            TO52</a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            分类</a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            归档</a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  
    <div class="reading-progress-bar"></div>
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://esept.github.io/2020/05/24/%E7%89%B9%E5%BE%81%E5%B7%A5%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/hsush.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Indéfini-未定义的我">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">特征工程</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-05-24T00:00:00+02:00">2020-05-24</time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index">
                    <span itemprop="name">python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="特征工程"><a href="#特征工程" class="headerlink" title="特征工程"></a>特征工程</h1><p>-&gt; 拿到的数据不规范，了解数据的一些信息和格式，便于后期工作<br>-&gt; 机器学习前的准备工作<br>-&gt; 前期是理论，后期是实践</p>
<span id="more"></span>

<h2 id="本周内容"><a href="#本周内容" class="headerlink" title="本周内容"></a>本周内容</h2><h3 id="1-机器学习的简单理解"><a href="#1-机器学习的简单理解" class="headerlink" title="1.机器学习的简单理解"></a>1.机器学习的简单理解</h3><p>和其他的计算机程序没有区别<br>核心也是算法和数据，从数据中学习，并建立模型<br>拿到源数据</p>
<blockquote>
<p>机器学习：选择一种学习算法，从数据中学习并建立成模型来 对新的数据进行预测的计算机科学<br>• 机器学习适用于：</p>
</blockquote>
<ol>
<li>不存在已知算法解决方案的复杂问题</li>
<li>需要大量手动调整或者规则列表超长的问题</li>
<li>可以适应环境波动的系统<br>• 机器学习就是要用数据和算法训练有效的模型，再用模型去预 测新的数据</li>
</ol>
<h3 id="2-机器学习中的基础概念"><a href="#2-机器学习中的基础概念" class="headerlink" title="2.机器学习中的基础概念"></a>2.机器学习中的基础概念</h3><ol>
<li>提供给算法的包含所需解决方案的训练数据，称为标签</li>
<li>属性加上其值 就是特征</li>
<li>通过给定的特征来预测一个目标数值，叫回归任务</li>
<li>用于训练模型的数据叫训练集</li>
<li>用于测试模型精度的数据叫测试集</li>
<li>每一条数据叫一个样本(x)，样本对应的结果叫标签(y)</li>
<li>模型在训练数据上表现良好，泛化不好叫过度拟合，反之欠拟合</li>
<li>模型训练就是通过训练数据找到算法最合适的参数</li>
</ol>
<h3 id="3-机器学习模型训练工作原理"><a href="#3-机器学习模型训练工作原理" class="headerlink" title="3.机器学习模型训练工作原理"></a>3.机器学习模型训练工作原理</h3><p>-&gt; 图片</p>
<h3 id="4-机器学习执行流程"><a href="#4-机器学习执行流程" class="headerlink" title="4.机器学习执行流程"></a>4.机器学习执行流程</h3><p>-&gt; 图片</p>
<h3 id="5-数据处理对于机器学习的重要性"><a href="#5-数据处理对于机器学习的重要性" class="headerlink" title="5.数据处理对于机器学习的重要性"></a>5.数据处理对于机器学习的重要性</h3><p>• 机器学习的核心问题：算法好坏和数据好坏<br>• 复杂问题，数据比算法更重要<br>• 数据处理主要解决的问题：</p>
<ol>
<li>数据量不足</li>
<li>训练数据不具备代表性</li>
<li>质量差的数据</li>
<li>特征筛选</li>
</ol>
<p>— 实践 —</p>
<h3 id="6-特征工程"><a href="#6-特征工程" class="headerlink" title="6.特征工程"></a>6.特征工程</h3><p>机器学习的关键是 提取出一组好的用来训练的特征集，这个过 程叫特征工程，包括：</p>
<ol>
<li>特征选择 从现有特征中选择最有用的特征进行训练</li>
<li>特征提取 将现有特征进行整合，产生更有用的特征，比 如降维算法</li>
<li>通过收集 新数据创造新特征</li>
</ol>
<h3 id="7-一个机器学习项目的数据处理流程"><a href="#7-一个机器学习项目的数据处理流程" class="headerlink" title="7.一个机器学习项目的数据处理流程"></a>7.一个机器学习项目的数据处理流程</h3><ol>
<li>真实数据观察全局</li>
<li>选择性能指标、检查假设</li>
<li>获取数据 创建工作区，快速查看数据结构，创建测试集</li>
<li>从可视化中探索数据 将数据可视化、寻找相关性、试验不同的属性组合</li>
<li>机器学习前的数据准备 数据清理、自定义转换器、特征缩放、转换流水线</li>
<li>选择训练模型 评估训练集、交叉验证、分析最佳模型及其错误、测试集评</li>
<li>模型调优</li>
<li>分析最佳模型和测试集评估</li>
<li>系统维护和监控</li>
</ol>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>目标：给机器学习提供更好的数据，才可以得到精度高的模型，来预测新数据<br>需要：     提供足够数据量的数据<br>        训练数据要具备代表性<br>        数据质量不能太差<br>        关键部分是提取出一组好的特征集来训练模型</p>
<h1 id="代码部分"><a href="#代码部分" class="headerlink" title="代码部分"></a>代码部分</h1><h2 id="获取数据与初步分析"><a href="#获取数据与初步分析" class="headerlink" title="获取数据与初步分析"></a>获取数据与初步分析</h2><p>需求模块</p>
<blockquote>
<p>jupyter,matplotlib,numpy,pandas,scipy,scikit-learn<br>引入操作系统【os】<br>引入pandas<br>加载外部数据</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">load_housing_data</span>(<span class="params">housing_path = <span class="string">&#x27;./&#x27;</span></span>):</span></span><br><span class="line">    csv_path = os.path.join(housing_path,<span class="string">&#x27;housing.csv&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> pd.read_csv(csv_path)</span><br><span class="line"></span><br><span class="line">housing = load_housing_data() <span class="comment"># 被引入的数据被叫做housing</span></span><br><span class="line">housing.head()</span><br><span class="line">housing.shape  <span class="comment"># 显示数据数量</span></span><br><span class="line">---&gt; (<span class="number">20640</span>, <span class="number">10</span>) <span class="comment"># 两万条数据，十个特征</span></span><br><span class="line">housing.info() <span class="comment"># 查看数据集的简单描述，得到每个属性和非空值数据量</span></span><br></pre></td></tr></table></figure>
<p>&lt;class ‘pandas.core.frame.DataFrame’&gt;<br>RangeIndex: 20640 entries, 0 to 20639<br>Data columns (total 10 columns):</p>
<h1 id="Column-Non-Null-Count-Dtype"><a href="#Column-Non-Null-Count-Dtype" class="headerlink" title="Column              Non-Null Count  Dtype"></a>Column              Non-Null Count  Dtype</h1><hr>
<p> 0   longitude           20640 non-null  float64<br> 1   latitude            20640 non-null  float64<br> 2   housing_median_age  20640 non-null  float64<br> 3   total_rooms         20640 non-null  float64<br> 4   total_bedrooms      20433 non-null  float64 -&gt; 有空值，需要补充或者删除掉<br> 5   population          20640 non-null  float64<br> 6   households          20640 non-null  float64<br> 7   median_income       20640 non-null  float64<br> 8   median_house_value  20640 non-null  float64<br> 9   ocean_proximity     20640 non-null  object -&gt; 分类<br>dtypes: float64(9), object(1)<br>memory usage: 1.6+ MB<br>—&gt; [total_bedrooms]      20433 non-null  float64 数据和其他的数量不同， 有一部分空值</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">housing[<span class="string">&#x27;ocean_proximity&#x27;</span>].value_counts()  <span class="comment"># 查看多少种分类</span></span><br><span class="line">housing.describe() <span class="comment"># 显示数值属性摘要</span></span><br></pre></td></tr></table></figure>
<p>—&gt;<br>INLAND        6551<br>NEAR OCEAN    2658<br>NEAR BAY      2290<br>ISLAND           5<br>Name: ocean_proximity, dtype: int64</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 用pandas绘制matplotlib的图表需要用到下面的魔法命令</span></span><br><span class="line">%matplotlib inline </span><br><span class="line"><span class="comment"># 将jupyter 作为matplotlib的后端显示</span></span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line">housing.hist(bins = <span class="number">50</span>,figsize = (<span class="number">20</span>,<span class="number">15</span>)) <span class="comment"># bins-数值个数；figsize-图片大小，特征值幅度大</span></span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
<p>—&gt; 图1，2，3</p>
<p>房龄和房价被设定了上限值-&gt; 最大值出现一条很高的直线：</p>
<ul>
<li>对设置了上线的区域从新采集，重新设置标签值</li>
<li>把五十万美元的区域数据从训练集中移除-&gt; 设置上限的区域移除<br>重尾 头高尾长 -&gt;数据前期有很高的直线，后期数据基本没有</li>
<li>转换数据，把数据形状变成偏钟型分布(正态分布)-&gt; 平均值为0，标准差为1<br>收入特征</li>
<li>数据提供的上游证实 是年薪 单位万美元， 提前对特征进行缩放是正常的，需要得知数据是如何缩放的</li>
</ul>
<h2 id="创建训练集和测试集"><a href="#创建训练集和测试集" class="headerlink" title="创建训练集和测试集"></a>创建训练集和测试集</h2><p>训练集用于模型训练 占整个数据集的80% ，测试占20%</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">split_train_test</span>(<span class="params">data,test_radio</span>):</span> <span class="comment">#（数据，比例）</span></span><br><span class="line">    np.random.seed(<span class="number">42</span>) <span class="comment"># 使每次返回的数据集都是相同的</span></span><br><span class="line">    indices = np.random.permutation(<span class="built_in">len</span>(data)) <span class="comment"># 对原来的数组进行重新洗牌，随机打乱原来的元素顺序；indices 新的乱序索引</span></span><br><span class="line">    test_set_size = <span class="built_in">int</span>(<span class="built_in">len</span>(data)*test_radio) <span class="comment"># 获取测试集大小，长度*比例</span></span><br><span class="line">    test_indices = indices[:test_set_size] <span class="comment"># 测试集索引</span></span><br><span class="line">    train_indices = indices[test_set_size:] <span class="comment"># 训练集索引</span></span><br><span class="line">    <span class="keyword">return</span> data.iloc[train_indices],data.iloc[test_indices]  <span class="comment"># 通过物理索引取值，返回测试和训练两个集</span></span><br><span class="line"></span><br><span class="line">train_set ,test_set = split_train_test(housing,<span class="number">0.2</span>)</span><br><span class="line"><span class="built_in">len</span>(train_set) <span class="comment"># 16512</span></span><br><span class="line"><span class="built_in">len</span>(test_set) <span class="comment"># 4128</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p> 但如果遇到数据库在不断增加的情况下上面的情况依然不稳定;<br>对样本设置唯一的标识符，对标识符去的哈希值，取哈希的最后一个字节，值小于等于51-&gt; 256%20,放入测试集;<br>哈希值相等的两个对象可能不是一个对象，哈希值不同的两个对象一定不是一个对象;<br>定义一个方法：样本标识符-&gt; 哈希值-&gt; 哈希值最后一个字节.</p>
</blockquote>
<p>运用哈希值是所有数据得到唯一标识符，让这些数据在后续的分类处理中使训练集不变</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib <span class="comment"># md5的包</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_set_check</span>(<span class="params">identifier,test_radio,<span class="built_in">hash</span> = hashlib.md5</span>):</span><span class="comment"># 测试集的检查（标识符，比例，默认哈希算法）</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">hash</span>(np.int64(identifier)).digest()[-<span class="number">1</span>]&lt;<span class="number">256</span> *test_radio <span class="comment">#np.int64:np的强制转换；返回摘要，作为二进制字符串 求得哈希值</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">split_train_test_by_id</span>(<span class="params">data,test_ratio,id_columns</span>):</span><span class="comment"># 通过标识符id识别；id_columns 选择哪一列作为标识符	</span></span><br><span class="line">    ids = data[id_columns] <span class="comment"># 取出标识符的所有数据 -&gt;所有文本的标识符</span></span><br><span class="line">    in_test_set = ids.apply(<span class="keyword">lambda</span> id_:test_set_check(id_,test_ratio)) <span class="comment"># apply方法：设定True和False来表示数据是否在测试集中</span></span><br><span class="line">    <span class="keyword">return</span> data.loc[~in_test_set],data.loc[in_test_set]<span class="comment"># 先训练集（不在测试集的【用到了取反】） ，在测试集</span></span><br><span class="line">housing_with_id = housing.reset_index() <span class="comment"># 使用行索引作为标识符id-&gt;行索引是自己加的，在第一列添加一列index</span></span><br><span class="line">train_set,test_set = split_train_test_by_id(housing_with_id,<span class="number">0.2</span>,<span class="string">&#x27;index&#x27;</span>) <span class="comment"># 用行索引初始化</span></span><br></pre></td></tr></table></figure>
<p> 基于行索引，不能删除和中间插入，只能末尾插入，否则行索引会变<br> 寻找稳定特征来创建唯一标识符，使用经纬度作为唯一标识符<br> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">housing_with_id[<span class="string">&#x27;id&#x27;</span>] = housing[<span class="string">&#x27;longitude&#x27;</span>]*<span class="number">1000</span>+housing[<span class="string">&#x27;latitude&#x27;</span>] <span class="comment"># 不重复的样本的id值</span></span><br><span class="line">train_set,test_set = split_train_test_by_id(housing_with_id,<span class="number">0.2</span>,<span class="string">&#x27;id&#x27;</span>) <span class="comment"># 用经纬度初始化</span></span><br><span class="line"></span><br><span class="line">添加一种sklearn的方法用于分割测试集和训练集</span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split <span class="comment"># 自带的，适用于不会更新的数据集的分类方式</span></span><br><span class="line">train_set,test_set = train_test_split(housing,test_size = <span class="number">0.2</span>,random_state = <span class="number">42</span>)</span><br></pre></td></tr></table></figure></p>
<h2 id="从数据的可视化中探索数据"><a href="#从数据的可视化中探索数据" class="headerlink" title="从数据的可视化中探索数据"></a>从数据的可视化中探索数据</h2><h3 id="分层采样"><a href="#分层采样" class="headerlink" title="分层采样"></a>分层采样</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">housing[<span class="string">&#x27;median_income&#x27;</span>].hist() <span class="comment"># 收入情况直方图</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>—&gt;图<br>对收入情况进行分层采样<br>希望测试集能够代表整个数据集中各种不同类型的收入<br>创建收入类别的属性<br>不能将数据分层太多，但每一层都应有相应的数据量<br>将收入的中位数/1.5，限制收入类别数量，使用ceil取整，得到离散类别，将大于五的数据类别合并</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">housing[<span class="string">&#x27;income_cat&#x27;</span>] = np.ceil(housing[<span class="string">&#x27;median_income&#x27;</span>]/<span class="number">1.5</span>) <span class="comment"># 新建特征，使用ceil方法将收入的中位数/1.5</span></span><br><span class="line"><span class="comment"># housing[&#x27;income_cat&#x27;].head(20)</span></span><br><span class="line">housing[<span class="string">&#x27;income_cat&#x27;</span>].where(housing[<span class="string">&#x27;income_cat&#x27;</span>]&lt;<span class="number">5</span>) <span class="comment"># 大于5的换成Nan</span></span><br><span class="line">housing[<span class="string">&#x27;income_cat&#x27;</span>].where(housing[<span class="string">&#x27;income_cat&#x27;</span>]&lt;<span class="number">5</span>,<span class="number">5.0</span>,inplace = <span class="literal">True</span>) <span class="comment"># 对所有上述值为nan的替换成5.0</span></span><br><span class="line">housing[<span class="string">&#x27;income_cat&#x27;</span>] = pd.cut(housing[<span class="string">&#x27;median_income&#x27;</span>],bins = [<span class="number">0.</span>,<span class="number">1.5</span>,<span class="number">3.0</span>,<span class="number">4.5</span>,<span class="number">6.</span>,np.inf],labels = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]) <span class="comment"># bins -&gt;区间 labels-&gt;把连续值转换成类别标签</span></span><br></pre></td></tr></table></figure>
<h3 id="统计类别包含的区域个数"><a href="#统计类别包含的区域个数" class="headerlink" title="统计类别包含的区域个数"></a>统计类别包含的区域个数</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">housing[<span class="string">&#x27;income_cat&#x27;</span>].value_counts()</span><br><span class="line"><span class="comment"># 收入类别直方图</span></span><br><span class="line">housing[<span class="string">&#x27;income_cat&#x27;</span>].hist()</span><br></pre></td></tr></table></figure>
<h3 id="根据类别进行分层采样"><a href="#根据类别进行分层采样" class="headerlink" title="根据类别进行分层采样"></a>根据类别进行分层采样</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> StratifiedShuffleSplit</span><br><span class="line">split = StratifiedShuffleSplit(n_splits = <span class="number">1</span>, test_size = <span class="number">0.2</span>,random_state = <span class="number">42</span>)<span class="comment"># n_splits = 1 默认是10</span></span><br><span class="line"><span class="keyword">for</span> train_index,test_index <span class="keyword">in</span> split.split(housing,housing[<span class="string">&#x27;income_cat&#x27;</span>]): <span class="comment"># 对数据进行分层采样</span></span><br><span class="line">    start_train_set = housing.loc[train_index]</span><br><span class="line">    start_test_set = housing.loc[test_index]</span><br><span class="line">start_train_set.shape <span class="comment">#---&gt;(16512, 11)</span></span><br></pre></td></tr></table></figure>

<h3 id="查看所有住房数据根据收入类别比例分布，收入占类别的百分比"><a href="#查看所有住房数据根据收入类别比例分布，收入占类别的百分比" class="headerlink" title="查看所有住房数据根据收入类别比例分布，收入占类别的百分比"></a>查看所有住房数据根据收入类别比例分布，收入占类别的百分比</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">start_train_set[<span class="string">&#x27;income_cat&#x27;</span>].value_counts()/<span class="built_in">len</span>(start_train_set) <span class="comment"># 分层抽样测试集合</span></span><br><span class="line">housing[<span class="string">&#x27;income_cat&#x27;</span>].value_counts()/<span class="built_in">len</span>(housing)<span class="comment"># 完整数据集合</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">income_cat_proportions</span>(<span class="params">data</span>):</span></span><br><span class="line">    <span class="keyword">return</span> data[<span class="string">&quot;income_cat&quot;</span>].value_counts() / <span class="built_in">len</span>(data)</span><br><span class="line"></span><br><span class="line">train_set, test_set = train_test_split(housing, test_size=<span class="number">0.2</span>, random_state=<span class="number">42</span>)</span><br><span class="line"></span><br><span class="line">compare_props = pd.DataFrame(&#123;</span><br><span class="line">    <span class="string">&quot;全部数据&quot;</span>: income_cat_proportions(housing),</span><br><span class="line">    <span class="string">&quot;分层抽样&quot;</span>: income_cat_proportions(start_test_set),</span><br><span class="line">    <span class="string">&quot;随机抽样&quot;</span>: income_cat_proportions(test_set),</span><br><span class="line">&#125;).sort_index()</span><br><span class="line">compare_props[<span class="string">&quot;随机. %error&quot;</span>] = <span class="number">100</span> * compare_props[<span class="string">&quot;随机抽样&quot;</span>] / compare_props[<span class="string">&quot;全部数据&quot;</span>] - <span class="number">100</span></span><br><span class="line">compare_props[<span class="string">&quot;分层. %error&quot;</span>] = <span class="number">100</span> * compare_props[<span class="string">&quot;分层抽样&quot;</span>] / compare_props[<span class="string">&quot;全部数据&quot;</span>] - <span class="number">100</span></span><br><span class="line">compare_props</span><br></pre></td></tr></table></figure>
<p>—&gt;三张图</p>
<p>把测试集已处理完成，用分层抽样的训练集数据来进行分析</p>
<h3 id="将地理数据可视化"><a href="#将地理数据可视化" class="headerlink" title="将地理数据可视化"></a>将地理数据可视化</h3><p>建立一个各个区域的分布图，以便于数据的可视化</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">housing.plot(kind = <span class="string">&#x27;scatter&#x27;</span>,x = <span class="string">&#x27;longitude&#x27;</span>,y = <span class="string">&#x27;latitude&#x27;</span>)</span><br><span class="line"><span class="comment"># 将alpha值设为0.1，可以看出高密度数据点的位置 0-&gt;完全透明 1-&gt;完全不透明</span></span><br><span class="line">housing.plot(kind = <span class="string">&#x27;scatter&#x27;</span>,x = <span class="string">&#x27;longitude&#x27;</span>,y = <span class="string">&#x27;latitude&#x27;</span>,alpha = <span class="number">0.1</span>)</span><br><span class="line"></span><br><span class="line">housing.plot(kind = <span class="string">&quot;scatter&quot;</span>,x = <span class="string">&#x27;longitude&#x27;</span>,y = <span class="string">&#x27;latitude&#x27;</span>,alpha = <span class="number">0.4</span>,</span><br><span class="line">            s = housing[<span class="string">&#x27;population&#x27;</span>]/<span class="number">100</span>,label = <span class="string">&quot;population&quot;</span>,figsize = (<span class="number">10</span>,<span class="number">7</span>),</span><br><span class="line">             c =<span class="string">&quot;median_house_value&quot;</span>,cmap = plt.get_cmap(<span class="string">&quot;gist_rainbow&quot;</span>),colorbar = <span class="literal">True</span>,</span><br><span class="line">             sharex = <span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 引入图片让图片成为背景</span></span><br><span class="line"><span class="keyword">import</span> matplotlib.image <span class="keyword">as</span> mping</span><br><span class="line">california_img = mping.imread(<span class="string">&#x27;./california.png&#x27;</span>)</span><br><span class="line"></span><br><span class="line">housing.plot(kind = <span class="string">&quot;scatter&quot;</span>,x = <span class="string">&#x27;longitude&#x27;</span>,y = <span class="string">&#x27;latitude&#x27;</span>,alpha = <span class="number">0.4</span>,</span><br><span class="line">            s = housing[<span class="string">&#x27;population&#x27;</span>]/<span class="number">100</span>,label = <span class="string">&quot;population&quot;</span>,figsize = (<span class="number">10</span>,<span class="number">7</span>),</span><br><span class="line">             c =<span class="string">&quot;median_house_value&quot;</span>,cmap = plt.get_cmap(<span class="string">&quot;rainbow&quot;</span>),colorbar = <span class="literal">True</span>,</span><br><span class="line">             sharex = <span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">plt.imshow(california_img,extent = [-<span class="number">124.55</span>,-<span class="number">113.8</span>,<span class="number">32.45</span>,<span class="number">42.05</span>],alpha = <span class="number">0.5</span>,</span><br><span class="line">          cmap = plt.get_cmap(<span class="string">&quot;rainbow&quot;</span>))</span><br><span class="line">plt.ylabel(<span class="string">&quot;Latitude&quot;</span>,fontsize = <span class="number">14</span>)</span><br><span class="line">plt.xlabel(<span class="string">&quot;Longitude&quot;</span>,fontsize = <span class="number">14</span>)</span><br><span class="line"></span><br><span class="line">--------------------------------------------------------------------------------------------------------</span><br><span class="line"><span class="comment"># 使价格成为标准</span></span><br><span class="line"><span class="keyword">import</span> matplotlib.image <span class="keyword">as</span> mping</span><br><span class="line">california_img = mping.imread(<span class="string">&#x27;./california.png&#x27;</span>)</span><br><span class="line"></span><br><span class="line">housing.plot(kind = <span class="string">&quot;scatter&quot;</span>,x = <span class="string">&#x27;longitude&#x27;</span>,y = <span class="string">&#x27;latitude&#x27;</span>,alpha = <span class="number">0.4</span>,</span><br><span class="line">            s = housing[<span class="string">&#x27;population&#x27;</span>]/<span class="number">100</span>,label = <span class="string">&quot;population&quot;</span>,figsize = (<span class="number">10</span>,<span class="number">7</span>),</span><br><span class="line">             c =<span class="string">&quot;median_house_value&quot;</span>,cmap = plt.get_cmap(<span class="string">&quot;rainbow&quot;</span>),colorbar = <span class="literal">False</span>,</span><br><span class="line">             sharex = <span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">plt.imshow(california_img,extent = [-<span class="number">124.55</span>,-<span class="number">113.8</span>,<span class="number">32.45</span>,<span class="number">42.05</span>],alpha = <span class="number">0.5</span>,</span><br><span class="line">          cmap = plt.get_cmap(<span class="string">&quot;rainbow&quot;</span>))</span><br><span class="line">plt.ylabel(<span class="string">&quot;Latitude&quot;</span>,fontsize = <span class="number">14</span>)</span><br><span class="line">plt.xlabel(<span class="string">&quot;Longitude&quot;</span>,fontsize = <span class="number">14</span>)</span><br><span class="line"></span><br><span class="line">prices = housing[<span class="string">&#x27;median_house_value&#x27;</span>]</span><br><span class="line">tick_values = np.linspace(prices.<span class="built_in">min</span>(),prices.<span class="built_in">max</span>(),<span class="number">11</span>)<span class="comment"># 在最小值与最大值之间十一等分</span></span><br><span class="line">cbar  =plt.colorbar()</span><br><span class="line">cbar.ax.set_yticklabels([<span class="string">&quot;$%dk&quot;</span>%(<span class="built_in">round</span>(v/<span class="number">1000</span>))<span class="keyword">for</span> v <span class="keyword">in</span> tick_values],fontsize = <span class="number">14</span>)</span><br><span class="line">cbar.set_label(<span class="string">&#x27;Median House Value&#x27;</span>,fontsize = <span class="number">16</span>)</span><br><span class="line">plt.legend(fontsize = <span class="number">16</span>)</span><br><span class="line"><span class="comment"># save_fig(&quot;california_housing_prices_plot&quot;)</span></span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
<h3 id="寻找特征之间的相关性"><a href="#寻找特征之间的相关性" class="headerlink" title="寻找特征之间的相关性"></a>寻找特征之间的相关性</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 房屋位置与地理位置 靠海 人口密度相关</span></span><br><span class="line"><span class="comment"># 寻找特征之间的相关性</span></span><br><span class="line"><span class="comment"># corr() 计算出所有特征之间的相关系数，称为皮尔逊相关系数-&gt; -1 到 1   0-&gt;无关  1-&gt;完全相关正相关  -1 -&gt;完全相关负相关</span></span><br><span class="line">corr_matrix = housing.corr()</span><br><span class="line">corr_matrix</span><br><span class="line"></span><br><span class="line">corr_matrix[<span class="string">&#x27;median_house_value&#x27;</span>].sort_values(ascending = <span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用pandas scatter_matrix 函数，绘制出特征之间的相关性</span></span><br><span class="line"><span class="keyword">from</span> pandas.plotting <span class="keyword">import</span> scatter_matrix</span><br><span class="line">attributes = [<span class="string">&#x27;median_house_value&#x27;</span>,<span class="string">&#x27;median_income&#x27;</span>,<span class="string">&#x27;total_rooms&#x27;</span>,<span class="string">&#x27;housing_median_age&#x27;</span>]</span><br><span class="line">scatter_matrix(housing[attributes],figsize = (<span class="number">12</span>,<span class="number">8</span>))</span><br><span class="line"></span><br><span class="line">housing.plot(kind = <span class="string">&#x27;scatter&#x27;</span>,x = <span class="string">&#x27;median_income&#x27;</span>,y = <span class="string">&#x27;median_house_value&#x27;</span>,alpha = <span class="number">0.1</span>) <span class="comment"># 房价和收入的关系</span></span><br><span class="line">housing.plot(kind = <span class="string">&#x27;scatter&#x27;</span>,x = <span class="string">&#x27;median_income&#x27;</span>,y = <span class="string">&#x27;median_house_value&#x27;</span>,alpha = <span class="number">0.1</span>)<span class="comment"># 扩大这个表的显示范围，</span></span><br><span class="line">plt.axis([<span class="number">0</span>,<span class="number">16</span>,<span class="number">0</span>,<span class="number">550000</span>])</span><br></pre></td></tr></table></figure>
<p>五十万美元是一条清晰线，因为在采样中被设置上限，45w，35w，28w也有虚线，可能是异常值，可以在后期将数据删除掉</p>
<ul>
<li> 在给机器学习算法输入数据之前，我们识别出了一些异常数据，需要提前清理掉，也发现了不同属性之间的某些联系，跟目标属性相关的联系</li>
<li> 某些属性分布显示出了明显的“重尾”分布，对进行转换处理，计算其对数</li>
<li> 在给机器学习算法输入数据之前，最后一件事儿，尝试各种属性的组合</li>
<li> 每个项目历程都不一样，大致思路都相识</li>
</ul>
 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加三组特征来计算关联性</span></span><br><span class="line">housing[<span class="string">&#x27;rooms_per_household&#x27;</span>] = housing[<span class="string">&#x27;total_rooms&#x27;</span>]/housing[<span class="string">&#x27;households&#x27;</span>]</span><br><span class="line">housing[<span class="string">&#x27;bedrooms_per_room&#x27;</span>] = housing[<span class="string">&#x27;total_bedrooms&#x27;</span>]/housing[<span class="string">&#x27;total_rooms&#x27;</span>]</span><br><span class="line">housing[<span class="string">&#x27;population_per_room&#x27;</span>] = housing[<span class="string">&#x27;population&#x27;</span>]/housing[<span class="string">&#x27;households&#x27;</span>]</span><br><span class="line"><span class="comment"># 关联矩阵</span></span><br><span class="line">corr_matrix = housing.corr()</span><br><span class="line">corr_matrix[<span class="string">&#x27;median_house_value&#x27;</span>].sort_values(ascending = <span class="literal">False</span>)</span><br></pre></td></tr></table></figure>
<p>-&gt;图</p>
<h2 id="机器学习算法的数据准备"><a href="#机器学习算法的数据准备" class="headerlink" title="机器学习算法的数据准备"></a>机器学习算法的数据准备</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># 得到一个分层抽样代表全局数据集的训练和测试集</span></span><br><span class="line">housing_labels = start_train_set[<span class="string">&#x27;median_house_value&#x27;</span>].copy() <span class="comment"># 将数据集的数据和标签分开-&gt; 分离房价</span></span><br><span class="line"></span><br><span class="line">housing = start_train_set.drop(<span class="string">&#x27;median_house_value&#x27;</span>,axis = <span class="number">1</span>) <span class="comment"># 删除房价这特征，因为要对她做出预测</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="数据清洗"><a href="#数据清洗" class="headerlink" title="数据清洗"></a>数据清洗</h3><p>大多数机器学算法无法在缺失的特征上工作，创建一些函数辅助，total_bedrooms有缺失，<br>放弃这些区域<br>放弃这个属性<br>将缺失值 设置为 某个值，（0， 平均数或者中位数都可以）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">housing.info()</span><br></pre></td></tr></table></figure>
<p>-&gt;图<br>清洗的方案</p>
<ol>
<li>删除这些值</li>
<li>将值为空的部分删除</li>
<li>对数据进行补充<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">rows = housing[housing.isnull().<span class="built_in">any</span>(axis = <span class="number">1</span>)] <span class="comment"># .isnull() 输出矩阵，并判断其中为空的值，若为空输出ture；.any（axis = 1）以行为基准取出输出Ture的行</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 放弃这些区域 .dropna()删除空值</span></span><br><span class="line"><span class="comment"># rows.dropna（subset = [&#x27;total_bedrooms&#x27;])</span></span><br><span class="line"><span class="comment"># 放弃这个属性</span></span><br><span class="line"><span class="comment"># rows.drop(&#x27;total_bedrooms&#x27;,axis = 1)</span></span><br><span class="line"><span class="comment"># 将缺失值 设置为 某个值，(0,平均数或者中午数都可以)</span></span><br><span class="line"><span class="comment"># 	----------------------------------------以上都不推荐</span></span><br><span class="line"><span class="comment"># 创建一个imputer实例，指定你要用属性中的中位数值替换该属性的缺失值</span></span><br><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> Imputer <span class="keyword">as</span> SimpleImputer <span class="comment"># 估算器</span></span><br><span class="line"></span><br><span class="line">imputer = SimpleImputer(strategy = <span class="string">&#x27;median&#x27;</span>) <span class="comment"># 一种算法；用中位数填补空值</span></span><br><span class="line"><span class="comment"># 使用fit（）将imputer实例适配到训练集</span></span><br><span class="line">housing_num = housing.drop(<span class="string">&#x27;ocean_proximity&#x27;</span>,axis = <span class="number">1</span>)<span class="comment"># 排除掉非浮点类型</span></span><br><span class="line">imputer.fit(housing_num) <span class="comment"># 适配；最后一列是非浮点类型因此有报错</span></span><br><span class="line"></span><br><span class="line">imputer.statistics_ <span class="comment"># 特征值中位数</span></span><br><span class="line">housing_num.median().values</span><br><span class="line">X = imputer.transform(housing_num) 返回的是各个特征的值，需要将他们转换成dataframe格式</span><br><span class="line">housing_tr = pd.DataFrame(X, columns = housing_num.columns, index = housing_num.index)</span><br><span class="line">housing_tr.info()<span class="comment"># 检测是否还有空值</span></span><br></pre></td></tr></table></figure></li>
</ol>
<p>-》</p>
<h3 id="scikit-Learn-机器学习框架"><a href="#scikit-Learn-机器学习框架" class="headerlink" title="scikit-Learn 机器学习框架"></a>scikit-Learn 机器学习框架</h3><p>Tensorflow-深度学习框架<br>一致性<br>估算器 比如：各种机器学习算法 fit()执行估算器<br>转换器 比如：LabelBinarizer transform() 执行转换数据集 fit_transform() 先估算，再转换<br>预测器 predict() 对给定的新数据集进行预测 score() 评估测试集的预测质量<br>检查<br>imputer.strategy_学习参数通过公共实例变量访问</p>
<h3 id="处理文本和分类属性"><a href="#处理文本和分类属性" class="headerlink" title="处理文本和分类属性"></a>处理文本和分类属性</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">housing_cat = housing[[<span class="string">&#x27;ocean_proximity&#x27;</span>]]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将文本转化成对应的数字分类 ， 使用转换器</span></span><br><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> LabelEncoder</span><br><span class="line">encoder = LabelEncoder()</span><br><span class="line"></span><br><span class="line">housing_cat_encoder = encoder.fit_transform(housing_cat)</span><br><span class="line">housing_cat_encoder</span><br><span class="line"><span class="comment"># -》 array([0, 0, 4, ..., 1, 0, 3]) 用从零到4⃣ 五个值将其中的类别进行替代</span></span><br><span class="line">encoder.classes_<span class="comment"># 全局的对象属性</span></span><br><span class="line"><span class="comment"># -》array([&#x27;&lt;1H OCEAN&#x27;, &#x27;INLAND&#x27;, &#x27;ISLAND&#x27;, &#x27;NEAR BAY&#x27;, &#x27;NEAR OCEAN&#x27;],dtype=object)</span></span><br></pre></td></tr></table></figure>

<p>机器学习算法会以为两个相近的数字比远的数字更相似，比如0，4 比 0，1相似度更高，<br>创建独热编码，当 &lt;1H ,第0个属性为1，其余都为0， 列别是InLand时候，另一个属性为1，其余为0，1为热，0为冷，独热编码<br>OneHotEncoder编码器, fit_trans需要二维数组， 转换housing_cat</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> OneHotEncoder <span class="comment"># 独热编码：属于哪个区域哪个区域的值就为1，其余为0</span></span><br><span class="line">encoder = OneHotEncoder() <span class="comment"># 独热编码转化器</span></span><br><span class="line">housing_cat_encoder.reshape(-<span class="number">1</span>, <span class="number">1</span>) <span class="comment"># 数据变成一列</span></span><br><span class="line">housing_cat_hot = encoder.fit_transform(housing_cat_encoder.reshape(-<span class="number">1</span>, <span class="number">1</span>)) <span class="comment"># 返回稀疏矩阵</span></span><br><span class="line"><span class="comment">#-》 &lt;16512x5 sparse matrix of type &#x27;&lt;class &#x27;numpy.float64&#x27;&gt;&#x27; with 16512 stored elements in Compressed Sparse Row format&gt;</span></span><br><span class="line">housing_cat_hot.toarray() <span class="comment"># 从稀疏矩阵 转换成 numpy</span></span><br><span class="line"><span class="comment">#-》</span></span><br><span class="line">		<span class="comment"># array([[1., 0., 0., 0., 0.],</span></span><br><span class="line">		<span class="comment">#        [1., 0., 0., 0., 0.],</span></span><br><span class="line">		<span class="comment">#        [0., 0., 0., 0., 1.],</span></span><br><span class="line">		<span class="comment">#        ...,</span></span><br><span class="line">		<span class="comment">#        [0., 1., 0., 0., 0.],</span></span><br><span class="line">		<span class="comment">#        [1., 0., 0., 0., 0.],</span></span><br><span class="line">		<span class="comment">#        [0., 0., 0., 1., 0.]])</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 一次完成两个转换 文本--整数类型--独热类型</span></span><br><span class="line">housing_cat</span><br><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> LabelBinarizer</span><br><span class="line">encoder = LabelBinarizer()</span><br><span class="line">housing_cat_1hot = encoder.fit_transform(housing_cat)</span><br><span class="line">housing_cat_1hot</span><br><span class="line"><span class="comment">#-》</span></span><br><span class="line"><span class="comment"># array([[1, 0, 0, 0, 0],</span></span><br><span class="line">       <span class="comment"># [1, 0, 0, 0, 0],</span></span><br><span class="line">       <span class="comment"># [0, 0, 0, 0, 1],</span></span><br><span class="line">       <span class="comment"># ...,</span></span><br><span class="line">       <span class="comment"># [0, 1, 0, 0, 0],</span></span><br><span class="line">       <span class="comment"># [1, 0, 0, 0, 0],</span></span><br><span class="line">       <span class="comment"># [0, 0, 0, 1, 0]])</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出稀疏矩阵</span></span><br><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> LabelBinarizer</span><br><span class="line">encoder = LabelBinarizer(sparse_output = <span class="literal">True</span>)</span><br><span class="line">housing_cat_1hot = encoder.fit_transform(housing_cat)</span><br><span class="line">housing_cat_1hot</span><br><span class="line"><span class="comment">#-》 &lt;16512x5 sparse matrix of type &#x27;&lt;class &#x27;numpy.int64&#x27;&gt;&#x27; with 16512 stored elements in Compressed Sparse Row format&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="自定义转换器"><a href="#自定义转换器" class="headerlink" title="自定义转换器"></a>自定义转换器</h3><p>必须包含fit和transfrom</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.base <span class="keyword">import</span> BaseEstimator, TransformerMixin</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过列表生成式取值</span></span><br><span class="line">rooms_ix, bedrooms_ix, population_ix, household_ix = [<span class="built_in">list</span>(housing.columns).index(col) <span class="keyword">for</span> col <span class="keyword">in</span> (<span class="string">&quot;total_rooms&quot;</span>, <span class="string">&quot;total_bedrooms&quot;</span>, <span class="string">&quot;population&quot;</span>, <span class="string">&quot;households&quot;</span>)]</span><br><span class="line">rooms_ix, bedrooms_ix, population_ix, household_ix </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CombinedAttributesAdder</span>(<span class="params">BaseEstimator, TransformerMixin</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, add_bedrooms_per_room = <span class="literal">True</span></span>):</span> <span class="comment"># 初始化</span></span><br><span class="line">        self.add_bedrooms_per_room = add_bedrooms_per_room</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">fit</span>(<span class="params">self, X, y = <span class="literal">None</span></span>):</span><span class="comment">#（本身，数据，标签（可以没有））</span></span><br><span class="line">        <span class="keyword">return</span> self</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">transform</span>(<span class="params">self, X, y = <span class="literal">None</span></span>):</span> <span class="comment">#（本身，数据，标签（可以没有））</span></span><br><span class="line"></span><br><span class="line">        rooms_per_household = X[:, rooms_ix] / X[:, household_ix]</span><br><span class="line">        population_per_household = X[:, population_ix] / X[:, household_ix]</span><br><span class="line">        <span class="keyword">if</span> self.add_bedrooms_per_room:</span><br><span class="line">            bedrooms_per_room = X[:, bedrooms_ix] / X[:, rooms_ix]</span><br><span class="line">            <span class="keyword">return</span> np.c_[X, rooms_per_household,population_per_household, bedrooms_per_room]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> np.c_[X, rooms_per_household,population_per_household]</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">attr_adder = CombinedAttributesAdder(add_bedrooms_per_room = <span class="literal">False</span>)</span><br><span class="line">housing_extra_attribs = attr_adder.transform(housing.values) <span class="comment">#转换成numpy矩阵</span></span><br><span class="line">housing_extra_attribs</span><br><span class="line"><span class="comment"># - 》</span></span><br><span class="line"><span class="comment"># array([[-121.89, 37.29, 38.0, ..., 2, 4.625368731563422, 2.094395280235988],</span></span><br><span class="line"><span class="comment">#        [-121.93, 37.05, 14.0, ..., 5, 6.008849557522124,2.7079646017699117],</span></span><br><span class="line"><span class="comment">#        [-117.2, 32.77, 31.0, ..., 2, 4.225108225108225, 2.0259740259740258],</span></span><br><span class="line"><span class="comment">#        ...,</span></span><br><span class="line"><span class="comment">#        [-116.4, 34.09, 9.0, ..., 3, 6.34640522875817,    2.742483660130719],</span></span><br><span class="line"><span class="comment">#        [-118.01, 33.82, 31.0, ..., 3, 5.50561797752809,  3.808988764044944],</span></span><br><span class="line"><span class="comment">#        [-122.45, 37.77, 52.0, ..., 3,4.843505477308295,1.9859154929577465]],dtype=object)</span></span><br><span class="line"></span><br><span class="line">housing_tr = pd.DataFrame(housing_extra_attribs)</span><br><span class="line"><span class="comment"># 		0 			1 		2 	3 		4 		5 		6 		7 			8 		9 		10	 	11</span></span><br><span class="line"><span class="comment"># 0 	-121.89 	37.29 	38 	1568 	351 	710 	339 	2.7042 	&lt;1H OCEAN 	2 	4.62537 	2.0944</span></span><br><span class="line"><span class="comment"># 1 	-121.93 	37.05 	14 	679 	108 	306 	113 	6.4214 	&lt;1H OCEAN 	5 	6.00885 	2.70796</span></span><br><span class="line"><span class="comment"># 2 	-117.2 		32.77 	31 	1952 	471 	936 	462 	2.8621 	NEAR OCEAN 	2 	4.22511 	2.02597</span></span><br><span class="line"><span class="comment"># 3 	-119.61 	36.31 	25 	1847 	371 	1460 	353 	1.8839 	INLAND 		2 	5.23229 	4.13598</span></span><br><span class="line"><span class="comment"># 4 	-118.59 	34.23 	17 	6592 	1525 	4459 	1463 	3.0347 	&lt;1H OCEAN 	3 	4.50581 	3.04785</span></span><br><span class="line"></span><br><span class="line">housing_extra_attribs = pd.DataFrame(</span><br><span class="line">    housing_extra_attribs,</span><br><span class="line">    columns=<span class="built_in">list</span>(housing.columns)+[<span class="string">&quot;rooms_per_household&quot;</span>, <span class="string">&quot;population_per_household&quot;</span>],</span><br><span class="line">    index=housing.index)</span><br><span class="line"></span><br><span class="line">housing_extra_attribs.sample(<span class="number">20</span>) <span class="comment">#采样</span></span><br></pre></td></tr></table></figure>
<h3 id="特征缩放"><a href="#特征缩放" class="headerlink" title="特征缩放"></a>特征缩放</h3><p>最重要也是最需要应用在数据上的转换器，就是特征缩放，输入数值属性有很大的比例差异，会导致机器学习算法性能表现不佳<br>房间总数 范围6到39320，收入中位数范围0到15<br>目标值通常不需要缩放<br>同比缩放所有属性，2种方法 最小-最大缩放和标准化<br>最小-最大缩放，又叫归一化，将值重新缩放到0到1之间，将值减去最小值并除以最大值和最小值差，如果你不希望是0到1，可以调整超参数feature_range<br>标准化 减去平均值，所以标准化均值总是0，然后除以方差，结果的分布具备单位方差，不同于归一化，标准化不将值绑定到特定范围，受异常值影响小<br>缩放器仅用来拟合训练集，不是完成的数据集</p>
<h3 id="转换流水线"><a href="#转换流水线" class="headerlink" title="转换流水线"></a>转换流水线</h3><p>许多数据转换的步骤需要以正确的顺序来执行， PipeLine来支持这样的转换<br>pipline构造函数会通过一系列名称/估算器的配对来定义步骤的序列，必须是转换器，必须有fit_fransform()方法<br>调用流水芡的fit方法时，会在所有转换器上按照顺序依次调用fit_transform()，将一个调用的输出作为参数传递给下一个调用方法，直到传递到最终<br>估算器，只会调用fit方法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 常规：</span></span><br><span class="line"><span class="keyword">from</span> sklearn.pipeline <span class="keyword">import</span> Pipeline</span><br><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> StandardScaler</span><br><span class="line"></span><br><span class="line">num_pipeline = Pipeline([</span><br><span class="line">        (<span class="string">&#x27;imputer&#x27;</span>, SimpleImputer(strategy=<span class="string">&quot;median&quot;</span>)),<span class="comment"># 数据缺失值中位数补偿</span></span><br><span class="line">        (<span class="string">&#x27;attribs_adder&#x27;</span>, CombinedAttributesAdder()), <span class="comment"># 自定义数据转换</span></span><br><span class="line">        (<span class="string">&#x27;std_scaler&#x27;</span>, StandardScaler())<span class="comment"># 数据标注化缩放</span></span><br><span class="line">    ])</span><br><span class="line"></span><br><span class="line">housing_num_tr = num_pipeline.fit_transform(housing_num)</span><br></pre></td></tr></table></figure>

<p>下面是一个完成流水线的例子</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 转换器 dataFrame -&gt; series -&gt; ndarray </span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DataFrameSelector</span>(<span class="params">BaseEstimator, TransformerMixin</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, attribute_names</span>):</span></span><br><span class="line">        self.attribute_names = attribute_names</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">fit</span>(<span class="params">self, X, y=<span class="literal">None</span></span>):</span></span><br><span class="line">        <span class="keyword">return</span> self</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">transform</span>(<span class="params">self, X</span>):</span></span><br><span class="line">        <span class="keyword">return</span> X[self.attribute_names].values</span><br><span class="line"></span><br><span class="line">num_attribs =<span class="built_in">list</span>(housing_num) </span><br><span class="line"><span class="comment">#-&gt;</span></span><br><span class="line">	<span class="comment"># [&#x27;longitude&#x27;,</span></span><br><span class="line">	<span class="comment">#  &#x27;latitude&#x27;,</span></span><br><span class="line">	<span class="comment">#  &#x27;housing_median_age&#x27;,</span></span><br><span class="line">	<span class="comment">#  &#x27;total_rooms&#x27;,</span></span><br><span class="line">	<span class="comment">#  &#x27;total_bedrooms&#x27;,</span></span><br><span class="line">	<span class="comment">#  &#x27;population&#x27;,</span></span><br><span class="line">	<span class="comment">#  &#x27;households&#x27;,</span></span><br><span class="line">	<span class="comment">#  &#x27;median_income&#x27;,</span></span><br><span class="line">	<span class="comment">#  &#x27;income_cat&#x27;]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 数据问题</span></span><br><span class="line">num_pipeline = Pipeline([</span><br><span class="line">        (<span class="string">&#x27;selector&#x27;</span>, DataFrameSelector(num_attribs)),</span><br><span class="line">        (<span class="string">&#x27;imputer&#x27;</span>, SimpleImputer(strategy=<span class="string">&quot;median&quot;</span>)),</span><br><span class="line">        (<span class="string">&#x27;attribs_adder&#x27;</span>, CombinedAttributesAdder()),</span><br><span class="line">        (<span class="string">&#x27;std_scaler&#x27;</span>, StandardScaler()),</span><br><span class="line">    ])</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> sklearn.base <span class="keyword">import</span> TransformerMixin </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyLabelBinarizer</span>(<span class="params">TransformerMixin</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, *args, **kwargs</span>):</span></span><br><span class="line">        self.encoder = LabelBinarizer(*args, **kwargs)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">fit</span>(<span class="params">self, x, y=<span class="number">0</span></span>):</span></span><br><span class="line">        self.encoder.fit(x)</span><br><span class="line">        <span class="keyword">return</span> self</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">transform</span>(<span class="params">self, x, y=<span class="number">0</span></span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.encoder.transform(x)</span><br><span class="line"></span><br><span class="line">cat_attribs = [<span class="string">&#x27;ocean_proximity&#x27;</span>]</span><br><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> LabelBinarizer</span><br><span class="line"></span><br><span class="line"><span class="comment"># 文本独热编码pipeline，两个pipeline同步执行</span></span><br><span class="line">cat_pipeline = Pipeline([</span><br><span class="line">        (<span class="string">&#x27;selector&#x27;</span>, DataFrameSelector(cat_attribs)),               </span><br><span class="line">        (<span class="string">&#x27;LabelBinarizer&#x27;</span>, MyLabelBinarizer()),</span><br><span class="line">    ])</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> sklearn.pipeline <span class="keyword">import</span> FeatureUnion</span><br><span class="line">full_pipeline = FeatureUnion(transformer_list=[</span><br><span class="line">        (<span class="string">&quot;num_pipline&quot;</span>, num_pipeline,),</span><br><span class="line">        (<span class="string">&#x27;cat_pipline&#x27;</span>, cat_pipeline),</span><br><span class="line">    ])</span><br><span class="line"></span><br><span class="line">housing_prepared = full_pipeline.fit_transform(housing)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="选择和训练模型"><a href="#选择和训练模型" class="headerlink" title="选择和训练模型"></a>选择和训练模型</h2><ul>
<li>获得数据</li>
<li>数据搜索</li>
<li>对训练集和测试集进行拆分</li>
<li>编写了转换数据流水线</li>
<li>自动清理和准备机器学习算法的数据</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df = pd.DataFrame(housing_prepared)</span><br><span class="line">df.head()</span><br></pre></td></tr></table></figure>
<h3 id="训练模型和评估训练集"><a href="#训练模型和评估训练集" class="headerlink" title="训练模型和评估训练集"></a>训练模型和评估训练集</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.linear_model <span class="keyword">import</span> LinearRegression <span class="comment">#倒入线性回归算法</span></span><br><span class="line">lin_reg = LinearRegression() <span class="comment"># 初始化估算器</span></span><br><span class="line">lin_reg.fit(housing_prepared, housing_labels) <span class="comment"># 训练数据匹配到算法，做模型训练</span></span><br><span class="line"><span class="comment"># -&gt; LinearRegression(copy_X=True, fit_intercept=True, n_jobs=1, normalize=False)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 预测数据</span></span><br><span class="line">some_data = housing.iloc[:<span class="number">5</span>]</span><br><span class="line">some_labels = housing_labels.iloc[:<span class="number">5</span>]</span><br><span class="line">some_data_prepared = full_pipeline.transform(some_data)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Predictions:&quot;</span>, lin_reg.predict(some_data_prepared))</span><br><span class="line"><span class="comment">#-&gt; Predictions: [203682.37379543 326371.39370781 204218.64588245  58685.4770482 194213.06443039]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> sklearn.metrics <span class="keyword">import</span> mean_squared_error <span class="comment"># 计算均方根误差</span></span><br><span class="line">housing_predictions = lin_reg.predict(housing_prepared)</span><br><span class="line">lin_mse = mean_squared_error(housing_labels, housing_predictions)</span><br><span class="line">lin_mse</span><br><span class="line">lin_rmse = np.sqrt(lin_mse)</span><br><span class="line">lin_rmse <span class="comment"># 预测房价和真实房价的误差</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 大多数地区的房屋中位数 在120000到265000美元之间，预测误差高达 68628,这是一个典型的模型对训练数据拟合不足的案例，</span></span><br><span class="line"><span class="comment"># 原因可能是特征无法提供足够的信息来做出更好的预测，或者模型本身不够强大，</span></span><br><span class="line"><span class="comment"># 1. 选择强大的模型，2 为算法提供更好的特征，3.减少对模型的限制等方法，</span></span><br><span class="line"><span class="comment"># 决策树可以找到复杂的非线性关系</span></span><br><span class="line"><span class="comment"># -&gt; 68376.64295459937</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> sklearn.tree <span class="keyword">import</span> DecisionTreeRegressor <span class="comment"># 决策树模型 决策树估算器</span></span><br><span class="line">tree_reg = DecisionTreeRegressor(random_state=<span class="number">42</span>)</span><br><span class="line">tree_reg.fit(housing_prepared, housing_labels)</span><br><span class="line"><span class="comment"># -》 DecisionTreeRegressor(criterion=&#x27;mse&#x27;, max_depth=None, max_features=None,max_leaf_nodes=None,min_impurity_decrease=0.0,min_impurity_split=None, min_samples_leaf=1,min_samples_split=2, min_weight_fraction_leaf=0.0,presort=False, random_state=42, splitter=&#x27;best&#x27;)</span></span><br><span class="line"></span><br><span class="line">housing_predictions = tree_reg.predict(housing_prepared)</span><br><span class="line">tree_mse = mean_squared_error(housing_labels, housing_predictions)</span><br><span class="line">tree_rmse = np.sqrt(tree_mse)</span><br><span class="line">tree_rmse</span><br><span class="line"><span class="comment"># -》0.0</span></span><br><span class="line"><span class="comment"># 完美，也可能是这个模型对数据严重过度拟合了，如何确认？轻易不要启动测试集，拿训练集中的一部分用于训练，另一部分用于模型的验证</span></span><br></pre></td></tr></table></figure>


<h3 id="使用交叉验证来更好的进行评估"><a href="#使用交叉验证来更好的进行评估" class="headerlink" title="使用交叉验证来更好的进行评估"></a>使用交叉验证来更好的进行评估</h3><p>多次（10次）训练和评估</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用train_test_split函数将训练集分为较小的训练集和验证集，然后根据这些较小的训练集来训练模型，并对其进行评估</span></span><br><span class="line"><span class="comment"># sklearn的交叉验证，将训练集随机分割成10个不同的子集，每个子集称为一个折叠，对模型进行10次训练和评估，每次挑选1个折叠进行评估，另外9个进行训练</span></span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> cross_val_score</span><br><span class="line"><span class="comment"># neg_mean_squared_error‘ 也就是 均方差回归损失 该统计参数是预测数据和原始数据对应点误差的平方和的均值</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 决策树交叉验证</span></span><br><span class="line">scores = cross_val_score(tree_reg, housing_prepared, housing_labels,</span><br><span class="line">                         scoring=<span class="string">&quot;neg_mean_squared_error&quot;</span>, cv=<span class="number">10</span>)</span><br><span class="line">tree_rmse_scores = np.sqrt(-scores)</span><br><span class="line">tree_rmse_scores</span><br><span class="line"></span><br><span class="line"><span class="comment"># -》array([70307.54079165, 67270.94561829, 71361.89886493, 68889.91784739,70992.94150631, 74140.66907294, 70607.72083897, 70576.13836762,76433.16342183, 70270.96266671])</span></span><br><span class="line"><span class="comment"># 比线性的值的误差更大</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">display_scores</span>(<span class="params">scores</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Scores:&quot;</span>, scores)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Mean:&quot;</span>, scores.mean())</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Standard deviation:&quot;</span>, scores.std())</span><br><span class="line">display_scores(tree_rmse_scores)</span><br><span class="line"><span class="comment"># -》</span></span><br><span class="line"><span class="comment"># Scores: [70307.54079165 67270.94561829 71361.89886493 68889.91784739 70992.94150631 74140.66907294 70607.72083897 70576.13836762 76433.16342183 70270.96266671]</span></span><br><span class="line"><span class="comment"># Mean: 71085.189899664</span></span><br><span class="line"><span class="comment"># Standard deviation: 2431.961029690467</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 线性 交叉验证</span></span><br><span class="line">lin_scores = cross_val_score(lin_reg, housing_prepared, housing_labels,scoring=<span class="string">&quot;neg_mean_squared_error&quot;</span>, cv=<span class="number">10</span>)</span><br><span class="line">lin_rmse_scores = np.sqrt(-lin_scores)</span><br><span class="line">display_scores(lin_rmse_scores)</span><br><span class="line"></span><br><span class="line"><span class="comment"># -》</span></span><br><span class="line"><span class="comment"># Scores: [66877.52325028 66608.120256   70575.91118868 74179.94799352 67683.32205678 71103.16843468 64782.65896552 67711.29940352 71080.40484136 67687.6384546 ]</span></span><br><span class="line"><span class="comment"># Mean: 68828.99948449328</span></span><br><span class="line"><span class="comment"># Standard deviation: 2662.7615706103443</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> sklearn.ensemble <span class="keyword">import</span> RandomForestRegressor <span class="comment"># 随机森林</span></span><br><span class="line">forest_reg = RandomForestRegressor(n_estimators=<span class="number">10</span>, random_state=<span class="number">42</span>)</span><br><span class="line">forest_reg.fit(housing_prepared, housing_labels)</span><br><span class="line"></span><br><span class="line"><span class="comment"># RandomForestRegressor(bootstrap=True, criterion=&#x27;mse&#x27;, max_depth=None,</span></span><br><span class="line"><span class="comment">#            max_features=&#x27;auto&#x27;, max_leaf_nodes=None,</span></span><br><span class="line"><span class="comment">#            min_impurity_decrease=0.0, min_impurity_split=None,</span></span><br><span class="line"><span class="comment">#            min_samples_leaf=1, min_samples_split=2,</span></span><br><span class="line"><span class="comment">#            min_weight_fraction_leaf=0.0, n_estimators=10, n_jobs=1,</span></span><br><span class="line"><span class="comment">#            oob_score=False, random_state=42, verbose=0, warm_start=False)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 误差比对</span></span><br><span class="line">housing_predictions = forest_reg.predict(housing_prepared)</span><br><span class="line">forest_mse = mean_squared_error(housing_labels, housing_predictions)</span><br><span class="line">forest_rmse = np.sqrt(forest_mse)</span><br><span class="line">forest_rmse</span><br><span class="line"></span><br><span class="line"><span class="comment">#-》 22112.540875989125</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 交叉验证</span></span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> cross_val_score</span><br><span class="line">forest_scores = cross_val_score(forest_reg, housing_prepared, housing_labels,scoring=<span class="string">&quot;neg_mean_squared_error&quot;</span>, cv=<span class="number">10</span>)</span><br><span class="line">forest_rmse_scores = np.sqrt(-forest_scores)</span><br><span class="line">display_scores(forest_rmse_scores)</span><br><span class="line"><span class="comment"># -》</span></span><br><span class="line"><span class="comment"># Scores: [51513.5500248  48821.99364978 53451.63889205 54910.55855153 50405.68166817 56772.90691171 51909.21824137 50516.14893695 55699.80788403 53107.7805515 ]</span></span><br><span class="line"><span class="comment"># Mean: 52710.92853118938</span></span><br><span class="line"><span class="comment"># Standard deviation: 2414.7271791176026</span></span><br></pre></td></tr></table></figure>
<h3 id="模型调参和网格搜索"><a href="#模型调参和网格搜索" class="headerlink" title="模型调参和网格搜索"></a>模型调参和网格搜索</h3><p>手动调整超参数，找到很好的组合很困难<br>使用GridSearchCV替你进行搜索，告诉它，进行试验的超参数是什么，和需要尝试的值，它会使用交叉验证评估所有超参数的可能组合</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> GridSearchCV <span class="comment"># 网格搜索</span></span><br><span class="line"></span><br><span class="line">param_grid = [ <span class="comment"># 参数-》两个参数组合</span></span><br><span class="line">    &#123;<span class="string">&#x27;n_estimators&#x27;</span>: [<span class="number">3</span>, <span class="number">10</span>, <span class="number">30</span>], <span class="string">&#x27;max_features&#x27;</span>: [<span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>]&#125;,</span><br><span class="line">    &#123;<span class="string">&#x27;bootstrap&#x27;</span>: [<span class="literal">False</span>], <span class="string">&#x27;n_estimators&#x27;</span>: [<span class="number">3</span>, <span class="number">10</span>], <span class="string">&#x27;max_features&#x27;</span>: [<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]&#125;,</span><br><span class="line">  ]</span><br><span class="line"></span><br><span class="line">forest_reg = RandomForestRegressor(random_state=<span class="number">42</span>) <span class="comment"># 将上面的组合被随机森林初始化</span></span><br><span class="line">grid_search = GridSearchCV(forest_reg, param_grid, cv=<span class="number">5</span>, <span class="comment"># 放在网格中，cv=5，使用五次的验证</span></span><br><span class="line">                           scoring=<span class="string">&#x27;neg_mean_squared_error&#x27;</span>, return_train_score=<span class="literal">True</span>)</span><br><span class="line">grid_search.fit(housing_prepared, housing_labels)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">grid_search.best_params_ <span class="comment"># 查询效果最好的组合</span></span><br><span class="line"><span class="comment">#-&gt; &#123;&#x27;max_features&#x27;: 6, &#x27;n_estimators&#x27;: 30&#125;</span></span><br><span class="line"></span><br><span class="line">grid_search.best_estimator_ <span class="comment"># 最好的估算器</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># RandomForestRegressor(bootstrap=True, criterion=&#x27;mse&#x27;, max_depth=None,</span></span><br><span class="line"><span class="comment">#            max_features=6, max_leaf_nodes=None, min_impurity_decrease=0.0,</span></span><br><span class="line"><span class="comment">#            min_impurity_split=None, min_samples_leaf=1,</span></span><br><span class="line"><span class="comment">#            min_samples_split=2, min_weight_fraction_leaf=0.0,</span></span><br><span class="line"><span class="comment">#            n_estimators=30, n_jobs=1, oob_score=False, random_state=42,</span></span><br><span class="line"><span class="comment">#            verbose=0, warm_start=False)</span></span><br><span class="line"></span><br><span class="line">cvres = grid_search.cv_results_</span><br><span class="line"><span class="keyword">for</span> mean_score, params <span class="keyword">in</span> <span class="built_in">zip</span>(cvres[<span class="string">&quot;mean_test_score&quot;</span>], cvres[<span class="string">&quot;params&quot;</span>]):</span><br><span class="line">    <span class="built_in">print</span>(np.sqrt(-mean_score), params)</span><br><span class="line"><span class="comment">#-》</span></span><br><span class="line"><span class="comment"># 64265.85210091941 &#123;&#x27;max_features&#x27;: 2, &#x27;n_estimators&#x27;: 3&#125;</span></span><br><span class="line"><span class="comment"># 55882.984840186626 &#123;&#x27;max_features&#x27;: 2, &#x27;n_estimators&#x27;: 10&#125;</span></span><br><span class="line"><span class="comment"># 53472.52977048399 &#123;&#x27;max_features&#x27;: 2, &#x27;n_estimators&#x27;: 30&#125;</span></span><br><span class="line"><span class="comment"># 61320.61721024631 &#123;&#x27;max_features&#x27;: 4, &#x27;n_estimators&#x27;: 3&#125;</span></span><br><span class="line"><span class="comment"># 53834.66617027598 &#123;&#x27;max_features&#x27;: 4, &#x27;n_estimators&#x27;: 10&#125;</span></span><br><span class="line"><span class="comment"># 51273.25987325864 &#123;&#x27;max_features&#x27;: 4, &#x27;n_estimators&#x27;: 30&#125;</span></span><br><span class="line"><span class="comment"># 59851.160077252265 &#123;&#x27;max_features&#x27;: 6, &#x27;n_estimators&#x27;: 3&#125;</span></span><br><span class="line"><span class="comment"># 53108.49267924178 &#123;&#x27;max_features&#x27;: 6, &#x27;n_estimators&#x27;: 10&#125;</span></span><br><span class="line"><span class="comment"># 50804.490677496164 &#123;&#x27;max_features&#x27;: 6, &#x27;n_estimators&#x27;: 30&#125;</span></span><br><span class="line"><span class="comment"># 59225.21977850634 &#123;&#x27;max_features&#x27;: 8, &#x27;n_estimators&#x27;: 3&#125;</span></span><br><span class="line"><span class="comment"># 52883.78258097852 &#123;&#x27;max_features&#x27;: 8, &#x27;n_estimators&#x27;: 10&#125;</span></span><br><span class="line"><span class="comment"># 50942.15913785863 &#123;&#x27;max_features&#x27;: 8, &#x27;n_estimators&#x27;: 30&#125;</span></span><br><span class="line"><span class="comment"># 62801.35724701795 &#123;&#x27;bootstrap&#x27;: False, &#x27;max_features&#x27;: 2, &#x27;n_estimators&#x27;: 3&#125;</span></span><br><span class="line"><span class="comment"># 54452.705621479254 &#123;&#x27;bootstrap&#x27;: False, &#x27;max_features&#x27;: 2, &#x27;n_estimators&#x27;: 10&#125;</span></span><br><span class="line"><span class="comment"># 61122.949491813 &#123;&#x27;bootstrap&#x27;: False, &#x27;max_features&#x27;: 3, &#x27;n_estimators&#x27;: 3&#125;</span></span><br><span class="line"><span class="comment"># 53014.33296453683 &#123;&#x27;bootstrap&#x27;: False, &#x27;max_features&#x27;: 3, &#x27;n_estimators&#x27;: 10&#125;</span></span><br><span class="line"><span class="comment"># 60252.65376680052 &#123;&#x27;bootstrap&#x27;: False, &#x27;max_features&#x27;: 4, &#x27;n_estimators&#x27;: 3&#125;</span></span><br><span class="line"><span class="comment"># 52716.55059637336 &#123;&#x27;bootstrap&#x27;: False, &#x27;max_features&#x27;: 4, &#x27;n_estimators&#x27;: 10&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>数据准备步骤也可以当作超参数来处理，网格搜索会自动查找是否添加你不确定的特征，比如是否使用转换器 combinedAttre的超参数add_bedrooms_per_rom<br>也可是使用它自动寻找处理问题的最佳方法，比如异常值，缺失特征，特征选择等</p>
<h4 id="随机搜索"><a href="#随机搜索" class="headerlink" title="随机搜索"></a>随机搜索</h4>
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/numpy/" rel="tag"># numpy</a>
          
            <a href="/tags/matplotlib/" rel="tag"># matplotlib</a>
          
            <a href="/tags/Jupyter-Notebook/" rel="tag"># Jupyter Notebook</a>
          
            <a href="/tags/Pandas/" rel="tag"># Pandas</a>
          
            <a href="/tags/python/" rel="tag"># python</a>
          
            <a href="/tags/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E4%B8%8E%E6%95%B0%E6%8D%AE%E6%8C%96%E6%8E%98/" rel="tag"># 数据分析与数据挖掘</a>
          
            <a href="/tags/sklearn/" rel="tag"># sklearn</a>
          
            <a href="/tags/projec/" rel="tag"># projec</a>
          
            <a href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" rel="tag"># 机器学习</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/05/17/numpy/" rel="next" title="numpy">
                <i class="fa fa-chevron-left"></i> numpy
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2020/05/24/%E7%BA%BF%E7%A8%8B%E6%B1%A0/" rel="prev" title="java_线程池">
                java_线程池 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/hsush.jpg"
                alt="" />
            
              <p class="site-author-name" itemprop="name"></p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives">
                
                    <span class="site-state-item-count">39</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    <span class="site-state-item-count">4</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    <span class="site-state-item-count">22</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%89%B9%E5%BE%81%E5%B7%A5%E7%A8%8B"><span class="nav-number">1.</span> <span class="nav-text">特征工程</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%AC%E5%91%A8%E5%86%85%E5%AE%B9"><span class="nav-number">1.1.</span> <span class="nav-text">本周内容</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E7%9A%84%E7%AE%80%E5%8D%95%E7%90%86%E8%A7%A3"><span class="nav-number">1.1.1.</span> <span class="nav-text">1.机器学习的简单理解</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B8%AD%E7%9A%84%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5"><span class="nav-number">1.1.2.</span> <span class="nav-text">2.机器学习中的基础概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E6%A8%A1%E5%9E%8B%E8%AE%AD%E7%BB%83%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="nav-number">1.1.3.</span> <span class="nav-text">3.机器学习模型训练工作原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B"><span class="nav-number">1.1.4.</span> <span class="nav-text">4.机器学习执行流程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E5%AF%B9%E4%BA%8E%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E7%9A%84%E9%87%8D%E8%A6%81%E6%80%A7"><span class="nav-number">1.1.5.</span> <span class="nav-text">5.数据处理对于机器学习的重要性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-%E7%89%B9%E5%BE%81%E5%B7%A5%E7%A8%8B"><span class="nav-number">1.1.6.</span> <span class="nav-text">6.特征工程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-%E4%B8%80%E4%B8%AA%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E9%A1%B9%E7%9B%AE%E7%9A%84%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E6%B5%81%E7%A8%8B"><span class="nav-number">1.1.7.</span> <span class="nav-text">7.一个机器学习项目的数据处理流程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-number">1.1.8.</span> <span class="nav-text">总结</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E9%83%A8%E5%88%86"><span class="nav-number">2.</span> <span class="nav-text">代码部分</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE%E4%B8%8E%E5%88%9D%E6%AD%A5%E5%88%86%E6%9E%90"><span class="nav-number">2.1.</span> <span class="nav-text">获取数据与初步分析</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Column-Non-Null-Count-Dtype"><span class="nav-number">3.</span> <span class="nav-text">Column              Non-Null Count  Dtype</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E8%AE%AD%E7%BB%83%E9%9B%86%E5%92%8C%E6%B5%8B%E8%AF%95%E9%9B%86"><span class="nav-number">3.1.</span> <span class="nav-text">创建训练集和测试集</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%8E%E6%95%B0%E6%8D%AE%E7%9A%84%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B8%AD%E6%8E%A2%E7%B4%A2%E6%95%B0%E6%8D%AE"><span class="nav-number">3.2.</span> <span class="nav-text">从数据的可视化中探索数据</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%86%E5%B1%82%E9%87%87%E6%A0%B7"><span class="nav-number">3.2.1.</span> <span class="nav-text">分层采样</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%9F%E8%AE%A1%E7%B1%BB%E5%88%AB%E5%8C%85%E5%90%AB%E7%9A%84%E5%8C%BA%E5%9F%9F%E4%B8%AA%E6%95%B0"><span class="nav-number">3.2.2.</span> <span class="nav-text">统计类别包含的区域个数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A0%B9%E6%8D%AE%E7%B1%BB%E5%88%AB%E8%BF%9B%E8%A1%8C%E5%88%86%E5%B1%82%E9%87%87%E6%A0%B7"><span class="nav-number">3.2.3.</span> <span class="nav-text">根据类别进行分层采样</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E6%89%80%E6%9C%89%E4%BD%8F%E6%88%BF%E6%95%B0%E6%8D%AE%E6%A0%B9%E6%8D%AE%E6%94%B6%E5%85%A5%E7%B1%BB%E5%88%AB%E6%AF%94%E4%BE%8B%E5%88%86%E5%B8%83%EF%BC%8C%E6%94%B6%E5%85%A5%E5%8D%A0%E7%B1%BB%E5%88%AB%E7%9A%84%E7%99%BE%E5%88%86%E6%AF%94"><span class="nav-number">3.2.4.</span> <span class="nav-text">查看所有住房数据根据收入类别比例分布，收入占类别的百分比</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B0%86%E5%9C%B0%E7%90%86%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96"><span class="nav-number">3.2.5.</span> <span class="nav-text">将地理数据可视化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%BB%E6%89%BE%E7%89%B9%E5%BE%81%E4%B9%8B%E9%97%B4%E7%9A%84%E7%9B%B8%E5%85%B3%E6%80%A7"><span class="nav-number">3.2.6.</span> <span class="nav-text">寻找特征之间的相关性</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95%E7%9A%84%E6%95%B0%E6%8D%AE%E5%87%86%E5%A4%87"><span class="nav-number">3.3.</span> <span class="nav-text">机器学习算法的数据准备</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E6%B8%85%E6%B4%97"><span class="nav-number">3.3.1.</span> <span class="nav-text">数据清洗</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#scikit-Learn-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E6%A1%86%E6%9E%B6"><span class="nav-number">3.3.2.</span> <span class="nav-text">scikit-Learn 机器学习框架</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%84%E7%90%86%E6%96%87%E6%9C%AC%E5%92%8C%E5%88%86%E7%B1%BB%E5%B1%9E%E6%80%A7"><span class="nav-number">3.3.3.</span> <span class="nav-text">处理文本和分类属性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E8%BD%AC%E6%8D%A2%E5%99%A8"><span class="nav-number">3.3.4.</span> <span class="nav-text">自定义转换器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%89%B9%E5%BE%81%E7%BC%A9%E6%94%BE"><span class="nav-number">3.3.5.</span> <span class="nav-text">特征缩放</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BD%AC%E6%8D%A2%E6%B5%81%E6%B0%B4%E7%BA%BF"><span class="nav-number">3.3.6.</span> <span class="nav-text">转换流水线</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%80%89%E6%8B%A9%E5%92%8C%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B"><span class="nav-number">3.4.</span> <span class="nav-text">选择和训练模型</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B%E5%92%8C%E8%AF%84%E4%BC%B0%E8%AE%AD%E7%BB%83%E9%9B%86"><span class="nav-number">3.4.1.</span> <span class="nav-text">训练模型和评估训练集</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E4%BA%A4%E5%8F%89%E9%AA%8C%E8%AF%81%E6%9D%A5%E6%9B%B4%E5%A5%BD%E7%9A%84%E8%BF%9B%E8%A1%8C%E8%AF%84%E4%BC%B0"><span class="nav-number">3.4.2.</span> <span class="nav-text">使用交叉验证来更好的进行评估</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A8%A1%E5%9E%8B%E8%B0%83%E5%8F%82%E5%92%8C%E7%BD%91%E6%A0%BC%E6%90%9C%E7%B4%A2"><span class="nav-number">3.4.3.</span> <span class="nav-text">模型调参和网格搜索</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%9A%8F%E6%9C%BA%E6%90%9C%E7%B4%A2"><span class="nav-number">3.4.3.1.</span> <span class="nav-text">随机搜索</span></a></li></ol></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">HsUSH</span>

  

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/theme-next/hexo-theme-next">NexT.Gemini</a> v6.0.1</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>














  











  



  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  

  
  
    <script type="text/javascript" src="/lib/reading_progress/reading_progress.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.0.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=6.0.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.0.1"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=6.0.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=6.0.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.0.1"></script>



  



	





  





  










  





  

  

  

  
  

  

  

  

</body>
</html>
